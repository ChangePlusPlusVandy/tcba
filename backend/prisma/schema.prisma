generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Announcements {
  id               String            @id @default(cuid())
  title            String
  content          String
  publishedDate    DateTime?
  isPublished      Boolean           @default(false)
  attachmentUrls   String[]
  createdByAdminId String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  slug             String            @unique
  AnnouncementTag  AnnouncementTag[]
  tags             Tag[]             @relation("AnnouncementsToTag")

  @@index([isPublished, createdAt(sort: Desc)])
  @@map("announcements")
}

model Tag {
  id              String            @id @default(cuid())
  name            String            @unique
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  AnnouncementTag AnnouncementTag[]
  BlogTag         BlogTag[]
  announcements   Announcements[]   @relation("AnnouncementsToTag")
  blogs           Blog[]            @relation("BlogsToTag")

  @@map("tags")
}

model AnnouncementTag {
  announcementId String
  tagId          String
  announcement   Announcements @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  tag            Tag           @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([announcementId, tagId])
  @@map("_announcement_tags")
}

model BlogTag {
  blogId String
  tagId  String
  blog   Blog   @relation(fields: [blogId], references: [id], onDelete: Cascade)
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([blogId, tagId])
  @@map("_blog_tags")
}

model Alert {
  id               String        @id @default(cuid())
  title            String
  content          String
  priority         AlertPriority @default(MEDIUM)
  publishedDate    DateTime?
  isPublished      Boolean       @default(false)
  attachmentUrls   String[]
  tags             String[]
  createdByAdminId String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@map("alerts")
}

model Organization {
  id                    String             @id @default(cuid())
  clerkId               String             @unique
  name                  String             @unique
  email                 String             @unique
  description           String?
  website               String?
  address               String?
  city                  String?
  state                 String?
  zipCode               String?
  latitude              Float?
  longitude             Float?
  primaryContactName    String
  primaryContactEmail   String
  primaryContactPhone   String
  secondaryContactName  String?
  secondaryContactEmail String?
  region                TennesseeRegion?
  organizationType      String?
  membershipActive      Boolean            @default(false)
  membershipDate        DateTime?
  membershipRenewalDate DateTime?
  organizationSize      OrganizationSize?
  role                  OrganizationRole   @default(MEMBER)
  status                OrganizationStatus @default(PENDING)
  tags                  String[]
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  notifyAlerts               Boolean            @default(true)
  notifyAnnouncements        Boolean            @default(true)
  notifyBlogs                Boolean            @default(true)
  notifySurveys              Boolean            @default(true)
  visibleInDirectory         Boolean            @default(true)
  lastCheckedAlertsAt        DateTime?
  lastCheckedAnnouncementsAt DateTime?
  lastCheckedBlogsAt         DateTime?
  lastCheckedMessagesAt      DateTime?
  surveyResponses            SurveyResponse[]

  @@map("organizations")
}

model SurveyResponse {
  id             String       @id @default(cuid())
  responses      Json?
  submittedDate  DateTime?
  surveyId       String
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  survey         Survey       @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  @@unique([surveyId, organizationId])
  @@map("surveyResponse")
}

model Survey {
  id              String           @id @default(cuid())
  title           String
  description     String?
  questions       Json
  dueDate         DateTime?
  isActive        Boolean          @default(false)
  isPublished     Boolean          @default(false)
  status          SurveyStatus     @default(DRAFT)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  surveyResponses SurveyResponse[]

  @@map("surveys")
}

model AdminUser {
  id           String  @id @default(cuid())
  clerkId      String  @unique
  email        String
  name         String
  isSuperAdmin Boolean @default(false)
  isActive     Boolean

  @@map("AdminUser")
}

model EmailSubscription {
  id                String   @id @default(cuid())
  email             String   @unique
  name              String?
  subscriptionTypes String[]
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("emailSubscriptions")
}

model Blog {
  id               String    @id @default(cuid())
  title            String
  content          String
  author           String
  featuredImageUrl String?
  isPublished      Boolean   @default(false)
  publishedDate    DateTime?
  attachmentUrls   String[]
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  slug             String    @unique
  BlogTag          BlogTag[]
  tags             Tag[]     @relation("BlogsToTag")

  @@index([isPublished, publishedDate(sort: Desc)])
  @@map("blogs")
}

model Notification {
  id            String           @id @default(cuid())
  type          NotificationType
  title         String
  contentId     String
  createdAt     DateTime         @default(now())
  lastCheckedAt DateTime?

  @@map("notifications")
}

model EmailHistory {
  id               String      @id @default(cuid())
  subject          String
  body             String
  recipientEmails  String[]
  recipientCount   Int
  filters          Json?
  scheduledFor     DateTime?
  sentAt           DateTime?
  status           EmailStatus @default(SCHEDULED)
  createdByAdminId String
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  @@map("email_history")
}

model PageContent {
  id           String   @id @default(cuid())
  page         String
  section      String
  contentKey   String
  contentValue String
  contentType  String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([page, section, contentKey])
  @@index([page])
  @@map("page_content")
}

enum EmailStatus {
  SCHEDULED
  SENT
  FAILED
}

enum OrganizationRole {
  ADMIN
  MEMBER
}

enum OrganizationStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum TennesseeRegion {
  EAST
  MIDDLE
  WEST
}

enum OrganizationSize {
  SMALL
  MEDIUM
  LARGE
  EXTRA_LARGE
}

enum AlertPriority {
  URGENT
  LOW
  MEDIUM
}

enum SurveyStatus {
  DRAFT
  ACTIVE
  CLOSED
  ARCHIVED
}

enum NotificationType {
  BLOG
  ANNOUNCEMENT
  ALERT
  SURVEY
}
